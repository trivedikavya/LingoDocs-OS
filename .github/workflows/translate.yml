name: Translate

on:
  push:
    branches: [main] # Runs when you push to the 'main' branch
    paths:
      - 'README.md' # Only run when README.md changes

permissions:
  contents: write # This is new and very important!

jobs:
  translate:
    runs-on: ubuntu-latest
    steps:
      # 1. Check out your code
      - uses: actions/checkout@v4

      # 2. Run the all-in-one Lingo command
      - name: Run Lingo.dev
        run: npx lingo.dev@latest ci --api-key "$LINGODOTDEV_API_KEY"
        env:
          LINGODOTDEV_API_KEY: ${{ secrets.LINGODOTDEV_API_KEY }}
          
      # 3. NEW STEP: Commit and push the new files
      - name: Commit translated files
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # Check if there are any changes
          if -z "$(git status --porcelain)"; then
            echo "No changes to commit."
            exit 0
          fi
          
          # Add, commit, and push the new files
          git add .
          git commit -m "docs: auto-translate README files"
          git push