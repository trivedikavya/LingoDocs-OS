name: Translate README

on:
  push:
    branches: [main]
    paths:
      - 'README.md' # 1. Trigger when the MAIN README.md changes

permissions:
  contents: write 

jobs:
  translate:
    runs-on: ubuntu-latest
    steps:
      # 2. Check out your code
      - uses: actions/checkout@v4

      # 3. Create the 'en' file from the main README.md
      - name: Sync README.md to "en" version
        run: |
          mkdir -p "readme languages"
          cp README.md "readme languages/README.en.md"
          
      # 4. Run Lingo.dev to translate
      - name: Run Lingo.dev
        run: npx lingo.dev@latest ci --api-key "$LINGODOTDEV_API_KEY"
        env:
          LINGODOTDEV_API_KEY: ${{ secrets.LINGODOTDEV_API_KEY }}
          
      # 5. Commit and push ALL new files (the .en, .es, .hi, etc.)
      - name: Commit translated files
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          if [ -z "$(git status --porcelain)" ]; then
            echo "No changes to commit."
            exit 0
          fi
          
          # Add all new files in the new folder
          git add "readme languages/"
          git add i18n.lock
          
          git commit -m "docs: auto-sync and translate README"
          git push